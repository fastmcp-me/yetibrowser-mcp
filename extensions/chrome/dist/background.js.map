{"version":3,"sources":["../../shared/src/background/index.ts"],"sourcesContent":["import type {\n  BridgeClientMessage,\n  BridgeResultMessage,\n  BridgeServerMessage,\n  CommandName,\n  CommandPayload,\n  CommandPayloadMap,\n  CommandResult,\n  ConsoleLogEntry,\n  DomSnapshot,\n  DomSnapshotEntry,\n  PageStateSnapshot,\n} from \"@yetidevworks/shared\";\n\nconst STORAGE_KEYS = {\n  connectedTabId: \"yetibrowser:connectedTabId\",\n  wsPort: \"yetibrowser:wsPort\",\n};\n\nconst DEFAULT_WS_PORT = 9010;\n\nlet connectedTabId: number | null = null;\nlet wsPort = DEFAULT_WS_PORT;\nlet socket: WebSocket | null = null;\nlet reconnectTimeout: ReturnType<typeof setTimeout> | null = null;\nlet keepAliveTimer: ReturnType<typeof setInterval> | null = null;\n\nchrome.runtime.onInstalled.addListener(() => {\n  console.log(\"[yetibrowser] extension installed\");\n});\n\nchrome.runtime.onMessage.addListener((message, _sender, sendResponse) => {\n  if (!message || typeof message !== \"object\") {\n    return;\n  }\n\n  if (message.type === \"yetibrowser/connect\") {\n    const { tabId } = message as { tabId: number };\n    setConnectedTab(tabId)\n      .then(() => sendResponse({ ok: true }))\n      .catch((error) => sendResponse({ ok: false, error: error instanceof Error ? error.message : String(error) }));\n    return true;\n  }\n\n  if (message.type === \"yetibrowser/disconnect\") {\n    clearConnectedTab()\n      .then(() => sendResponse({ ok: true }))\n      .catch((error) => sendResponse({ ok: false, error: error instanceof Error ? error.message : String(error) }));\n    return true;\n  }\n\n  if (message.type === \"yetibrowser/getState\") {\n    sendResponse({\n      tabId: connectedTabId,\n      wsPort,\n      socketConnected: socket?.readyState === WebSocket.OPEN,\n    });\n    return;\n  }\n});\n\nchrome.storage.onChanged.addListener((changes, area) => {\n  if (area !== \"local\") {\n    return;\n  }\n\n  if (STORAGE_KEYS.connectedTabId in changes) {\n    const value = changes[STORAGE_KEYS.connectedTabId]?.newValue;\n    connectedTabId = typeof value === \"number\" ? value : null;\n    console.log(\"[yetibrowser] connected tab changed\", connectedTabId);\n  }\n\n  if (STORAGE_KEYS.wsPort in changes) {\n    const value = changes[STORAGE_KEYS.wsPort]?.newValue;\n    wsPort = typeof value === \"number\" && Number.isFinite(value) ? value : DEFAULT_WS_PORT;\n    console.log(\"[yetibrowser] websocket port changed\", wsPort);\n    reconnectWebSocket();\n  }\n});\n\nvoid bootstrap();\n\nasync function bootstrap(): Promise<void> {\n  const stored = await chrome.storage.local.get(STORAGE_KEYS);\n  const storedTabId = stored[STORAGE_KEYS.connectedTabId];\n  const storedPort = stored[STORAGE_KEYS.wsPort];\n\n  if (typeof storedTabId === \"number\") {\n    connectedTabId = storedTabId;\n    await initializeTab(storedTabId);\n  }\n\n  if (typeof storedPort === \"number\" && Number.isFinite(storedPort)) {\n    wsPort = storedPort;\n  }\n\n  connectWebSocket();\n  void updateBadge();\n}\n\nfunction connectWebSocket(): void {\n  if (socket && socket.readyState === WebSocket.OPEN) {\n    return;\n  }\n\n  if (socket && socket.readyState === WebSocket.CONNECTING) {\n    return;\n  }\n\n  try {\n    socket = new WebSocket(`ws://localhost:${wsPort}`);\n  } catch (error) {\n    console.error(\"[yetibrowser] failed to create WebSocket\", error);\n    scheduleReconnect();\n    return;\n  }\n\n  socket.addEventListener(\"open\", () => {\n    console.log(\"[yetibrowser] connected to MCP server\");\n    if (reconnectTimeout !== null) {\n      clearTimeout(reconnectTimeout);\n      reconnectTimeout = null;\n    }\n    sendHello();\n    startKeepAlive();\n    void updateBadge();\n  });\n\n  socket.addEventListener(\"message\", (event) => {\n    handleSocketMessage(event.data).catch((error) => {\n      console.error(\"[yetibrowser] failed to handle message\", error);\n    });\n  });\n\n  socket.addEventListener(\"close\", () => {\n    console.warn(\"[yetibrowser] MCP socket closed\");\n    socket = null;\n    stopKeepAlive();\n    scheduleReconnect();\n    void updateBadge();\n  });\n\n  socket.addEventListener(\"error\", (error) => {\n    console.error(\"[yetibrowser] MCP socket error\", error);\n  });\n}\n\nfunction reconnectWebSocket(): void {\n  if (socket) {\n    try {\n      socket.close();\n    } catch (error) {\n      console.error(\"[yetibrowser] failed to close socket before reconnect\", error);\n    }\n    socket = null;\n  }\n  stopKeepAlive();\n  connectWebSocket();\n}\n\nfunction scheduleReconnect(): void {\n  if (reconnectTimeout !== null) {\n    return;\n  }\n\n  reconnectTimeout = setTimeout(() => {\n    reconnectTimeout = null;\n    connectWebSocket();\n  }, 2000);\n}\n\nfunction sendHello(): void {\n  if (!socket || socket.readyState !== WebSocket.OPEN) {\n    return;\n  }\n\n  const message: BridgeClientMessage = {\n    type: \"hello\",\n    client: \"yetibrowser-extension\",\n    version: chrome.runtime.getManifest().version,\n  };\n  socket.send(JSON.stringify(message));\n}\n\nfunction startKeepAlive(): void {\n  stopKeepAlive();\n  keepAliveTimer = setInterval(() => {\n    if (!socket || socket.readyState !== WebSocket.OPEN) {\n      return;\n    }\n    const message: BridgeClientMessage = {\n      type: \"event\",\n      event: \"heartbeat\",\n      payload: Date.now(),\n    };\n    socket.send(JSON.stringify(message));\n  }, 20_000);\n}\n\nfunction stopKeepAlive(): void {\n  if (keepAliveTimer !== null) {\n    clearInterval(keepAliveTimer);\n    keepAliveTimer = null;\n  }\n}\n\nasync function handleSocketMessage(data: unknown): Promise<void> {\n  if (!socket) {\n    return;\n  }\n\n  let message: BridgeServerMessage;\n  try {\n    message = JSON.parse(String(data));\n  } catch (error) {\n    console.error(\"[yetibrowser] invalid message from server\", error);\n    return;\n  }\n\n  if (message.type !== \"call\") {\n    console.warn(\"[yetibrowser] unsupported message type\", message);\n    return;\n  }\n\n  try {\n    const result = await dispatchCommand(message.command, message.payload as CommandPayload<CommandName>);\n    respond({\n      type: \"result\",\n      id: message.id,\n      command: message.command,\n      ok: true,\n      result,\n    });\n  } catch (error) {\n    const messageText = error instanceof Error ? error.message : String(error);\n    respond({\n      type: \"result\",\n      id: message.id,\n      command: message.command,\n      ok: false,\n      error: messageText,\n    });\n  }\n}\n\nfunction respond(message: BridgeResultMessage): void {\n  if (!socket || socket.readyState !== WebSocket.OPEN) {\n    return;\n  }\n  socket.send(JSON.stringify(message));\n}\n\nasync function dispatchCommand<K extends CommandName>(\n  command: K,\n  payload: CommandPayload<K>,\n): Promise<CommandResult<K>> {\n  switch (command) {\n    case \"ping\":\n      return { ok: true } as CommandResult<K>;\n    case \"getUrl\":\n      return { url: (await ensureTab()).url ?? \"about:blank\" } as CommandResult<K>;\n    case \"getTitle\":\n      return { title: (await ensureTab()).title ?? \"\" } as CommandResult<K>;\n    case \"snapshot\": {\n      const snapshot = await captureSnapshot();\n      return snapshot as CommandResult<K>;\n    }\n    case \"navigate\": {\n      const { url } = payload as CommandPayloadMap[\"navigate\"];\n      await navigateTo(url);\n      return { ok: true } as CommandResult<K>;\n    }\n    case \"goBack\":\n      await goBack();\n      return { ok: true } as CommandResult<K>;\n    case \"goForward\":\n      await goForward();\n      return { ok: true } as CommandResult<K>;\n    case \"wait\": {\n      const { seconds } = payload as CommandPayloadMap[\"wait\"];\n      await delay(seconds * 1000);\n      return { ok: true } as CommandResult<K>;\n    }\n    case \"pressKey\": {\n      const { key } = payload as CommandPayloadMap[\"pressKey\"];\n      await simulateKeyPress(key);\n      return { ok: true } as CommandResult<K>;\n    }\n    case \"click\": {\n      const { selector, description } = payload as CommandPayloadMap[\"click\"];\n      await clickElement(selector, description);\n      return { ok: true } as CommandResult<K>;\n    }\n    case \"hover\": {\n      const { selector, description } = payload as CommandPayloadMap[\"hover\"];\n      await hoverElement(selector, description);\n      return { ok: true } as CommandResult<K>;\n    }\n    case \"type\": {\n      const { selector, text, submit, description } = payload as CommandPayloadMap[\"type\"];\n      await typeIntoElement(selector, text, submit ?? false, description);\n      return { ok: true } as CommandResult<K>;\n    }\n    case \"selectOption\": {\n      const { selector, values, description } = payload as CommandPayloadMap[\"selectOption\"];\n      await selectOptions(selector, values, description);\n      return { ok: true } as CommandResult<K>;\n    }\n    case \"screenshot\": {\n      const { fullPage } = payload as CommandPayloadMap[\"screenshot\"];\n      const { data, mimeType } = await takeScreenshot(fullPage ?? false);\n      return { data, mimeType } as CommandResult<K>;\n    }\n    case \"getConsoleLogs\": {\n      const logs = await readConsoleLogs();\n      return logs as CommandResult<K>;\n    }\n    case \"pageState\": {\n      const state = await capturePageState();\n      return state as CommandResult<K>;\n    }\n    default:\n      throw new Error(`Unsupported command ${command satisfies never}`);\n  }\n}\n\nasync function ensureTab(): Promise<chrome.tabs.Tab> {\n  if (connectedTabId === null) {\n    throw new Error(\"No tab connected. Open the YetiBrowser popup and connect the target tab.\");\n  }\n\n  try {\n    return await chrome.tabs.get(connectedTabId);\n  } catch (error) {\n    console.warn(\"[yetibrowser] failed to get connected tab\", error);\n    await clearConnectedTab();\n    throw new Error(\"Connected tab is no longer available. Reconnect from the popup and try again.\");\n  }\n}\n\nasync function setConnectedTab(tabId: number): Promise<void> {\n  await chrome.storage.local.set({ [STORAGE_KEYS.connectedTabId]: tabId });\n  connectedTabId = tabId;\n  await initializeTab(tabId);\n  void updateBadge();\n}\n\nasync function clearConnectedTab(): Promise<void> {\n  await chrome.storage.local.remove(STORAGE_KEYS.connectedTabId);\n  connectedTabId = null;\n  void updateBadge();\n}\n\nasync function navigateTo(url: string): Promise<void> {\n  const tab = await ensureTab();\n  await chrome.tabs.update(tab.id!, { url });\n  await waitForTabComplete(tab.id!);\n  await initializeTab(tab.id!);\n}\n\nasync function goBack(): Promise<void> {\n  const tab = await ensureTab();\n  try {\n    await chrome.tabs.goBack(tab.id!);\n  } catch (error) {\n    console.warn(\"[yetibrowser] unable to navigate back\", error);\n  }\n  await waitForTabComplete(tab.id!);\n  await initializeTab(tab.id!);\n}\n\nasync function goForward(): Promise<void> {\n  const tab = await ensureTab();\n  try {\n    await chrome.tabs.goForward(tab.id!);\n  } catch (error) {\n    console.warn(\"[yetibrowser] unable to navigate forward\", error);\n  }\n  await waitForTabComplete(tab.id!);\n  await initializeTab(tab.id!);\n}\n\nasync function waitForTabComplete(tabId: number): Promise<void> {\n  const tab = await chrome.tabs.get(tabId);\n  if (tab.status === \"complete\") {\n    return;\n  }\n\n  await new Promise<void>((resolve) => {\n    const listener = (updatedTabId: number, info: chrome.tabs.TabChangeInfo) => {\n      if (updatedTabId === tabId && info.status === \"complete\") {\n        chrome.tabs.onUpdated.removeListener(listener);\n        resolve();\n      }\n    };\n    chrome.tabs.onUpdated.addListener(listener);\n  });\n}\n\nasync function captureSnapshot(): Promise<{ formatted: string; raw: DomSnapshot }> {\n  const tab = await ensureTab();\n  const results = await chrome.scripting.executeScript({\n    target: { tabId: tab.id! },\n    func: collectSnapshot,\n  });\n\n  const scriptResult = results[0]?.result as { snapshot: DomSnapshot } | string | undefined;\n  if (!scriptResult || typeof scriptResult === \"string\") {\n    const fallback: DomSnapshot = {\n      title: tab.title ?? \"\",\n      url: tab.url ?? \"about:blank\",\n      capturedAt: new Date().toISOString(),\n      entries: [],\n    };\n    return {\n      formatted: typeof scriptResult === \"string\" ? scriptResult : formatSnapshot(fallback),\n      raw: fallback,\n    };\n  }\n\n  const snapshot = scriptResult.snapshot;\n  if (!snapshot.capturedAt) {\n    snapshot.capturedAt = new Date().toISOString();\n  }\n  return {\n    formatted: formatSnapshot(snapshot),\n    raw: snapshot,\n  };\n}\n\nasync function capturePageState(): Promise<PageStateSnapshot> {\n  const fallback: PageStateSnapshot = {\n    forms: [],\n    localStorage: [],\n    sessionStorage: [],\n    cookies: [],\n    capturedAt: new Date().toISOString(),\n  };\n\n  const response = await runInPage(() => {\n    const computeSelector = (element: Element): string => {\n      if (element.id) {\n        return `#${element.id}`;\n      }\n\n      const parts: string[] = [];\n      let current: Element | null = element;\n\n      while (current && parts.length < 5) {\n        const tag = current.tagName.toLowerCase();\n        const classes = (current.className || \"\")\n          .toString()\n          .split(/\\s+/)\n          .filter(Boolean)\n          .slice(0, 2)\n          .map((cls) => cls.replace(/[^a-zA-Z0-9_-]/g, \"\"))\n          .filter(Boolean);\n        let part = tag;\n        if (classes.length) {\n          part += `.${classes.join(\".\")}`;\n        }\n        const parent = current.parentElement;\n        if (parent) {\n          const siblings = Array.from(parent.children).filter((child) => child.tagName === current!.tagName);\n          if (siblings.length > 1) {\n            const index = siblings.indexOf(current) + 1;\n            part += `:nth-of-type(${index})`;\n          }\n        }\n        parts.push(part);\n        current = current.parentElement;\n      }\n\n      return parts.reverse().join(\" > \");\n    };\n\n    const readStorage = (storage: Storage) => {\n      const entries: Array<{ key: string; value: string }> = [];\n      const limit = Math.min(storage.length, 100);\n      for (let index = 0; index < limit; index += 1) {\n        const key = storage.key(index);\n        if (!key) {\n          continue;\n        }\n        try {\n          const value = storage.getItem(key) ?? \"\";\n          entries.push({ key, value });\n        } catch (error) {\n          entries.push({ key, value: \"<unavailable>\" });\n        }\n      }\n      return entries;\n    };\n\n    const readCookies = () => {\n      const raw = document.cookie;\n      if (!raw) {\n        return [] as Array<{ key: string; value: string }>;\n      }\n      return raw.split(\";\").slice(0, 50).map((part) => {\n        const [name, ...rest] = part.split(\"=\");\n        return { key: name.trim(), value: rest.join(\"=\").trim() };\n      });\n    };\n\n    const forms = Array.from(document.querySelectorAll(\"form\"))\n      .slice(0, 25)\n      .map((form) => {\n        const fields: Array<{ selector: string; name?: string; type?: string; value?: string; label?: string }> = [];\n        const elements = Array.from(form.elements ?? []).slice(0, 50);\n\n        for (const element of elements) {\n          if (\n            !(\n              element instanceof HTMLInputElement ||\n              element instanceof HTMLTextAreaElement ||\n              element instanceof HTMLSelectElement\n            )\n          ) {\n            continue;\n          }\n\n          const selector = computeSelector(element);\n          const base: { selector: string; name?: string; type?: string; value?: string; label?: string } = {\n            selector,\n            name: element.getAttribute(\"name\") ?? undefined,\n          };\n\n          if (element instanceof HTMLInputElement) {\n            base.type = element.type;\n            if (element.type === \"password\") {\n              base.value = \"[redacted]\";\n            } else if (element.type === \"file\") {\n              base.value = element.files?.length ? `${element.files.length} file(s)` : \"\";\n            } else {\n              base.value = element.value;\n            }\n            base.label = element.labels?.[0]?.innerText.trim() || element.placeholder || undefined;\n          } else if (element instanceof HTMLTextAreaElement) {\n            base.type = \"textarea\";\n            base.value = element.value;\n            base.label = element.labels?.[0]?.innerText.trim() || element.placeholder || undefined;\n          } else if (element instanceof HTMLSelectElement) {\n            base.type = \"select\";\n            base.value = Array.from(element.selectedOptions)\n              .map((option) => option.value || option.label)\n              .join(\", \");\n            base.label = element.labels?.[0]?.innerText.trim() || undefined;\n          }\n\n          fields.push(base);\n        }\n\n        return {\n          selector: computeSelector(form),\n          name: form.getAttribute(\"name\") ?? undefined,\n          method: form.getAttribute(\"method\")?.toUpperCase() ?? undefined,\n          action: form.getAttribute(\"action\") ?? undefined,\n          fields,\n        };\n      });\n\n    const snapshot: PageStateSnapshot = {\n      forms,\n      localStorage: readStorage(window.localStorage),\n      sessionStorage: readStorage(window.sessionStorage),\n      cookies: readCookies(),\n      capturedAt: new Date().toISOString(),\n    };\n\n    return { ok: true, value: snapshot } as const;\n  }, []);\n\n  return response ?? fallback;\n}\n\nfunction collectSnapshot(): { snapshot: DomSnapshot } {\n  function computeSelector(element: Element): string {\n    if (element.id) {\n      return `#${element.id}`;\n    }\n\n    const parts: string[] = [];\n    let current: Element | null = element;\n\n    while (current && parts.length < 5) {\n      const tag = current.tagName.toLowerCase();\n      const classes = (current.className || \"\")\n        .toString()\n        .split(/\\s+/)\n        .filter(Boolean)\n        .slice(0, 2)\n        .map((cls) => cls.replace(/[^a-zA-Z0-9_-]/g, \"\"))\n        .filter(Boolean);\n      let part = tag;\n      if (classes.length) {\n        part += `.${classes.join(\".\")}`;\n      }\n      const parent = current.parentElement;\n      if (parent) {\n        const siblings = Array.from(parent.children).filter((child) => child.tagName === current!.tagName);\n        if (siblings.length > 1) {\n          const index = siblings.indexOf(current) + 1;\n          part += `:nth-of-type(${index})`;\n        }\n      }\n      parts.push(part);\n      current = current.parentElement;\n    }\n\n    return parts.reverse().join(\" > \");\n  }\n\n  function makeName(element: Element): string {\n    if (element instanceof HTMLInputElement || element instanceof HTMLTextAreaElement) {\n      return element.placeholder || element.value || element.name || element.id || element.type;\n    }\n\n    if (element instanceof HTMLSelectElement) {\n      return element.options[element.selectedIndex]?.label || element.name || element.id || \"select\";\n    }\n\n    const text = element.textContent?.trim();\n    if (text) {\n      return text.slice(0, 160);\n    }\n\n    return element.getAttribute(\"aria-label\") || element.getAttribute(\"title\") || element.tagName.toLowerCase();\n  }\n\n  const targets = Array.from(\n    document.querySelectorAll(\"a, button, input, textarea, select, [role='button'], [role='link']\"),\n  ) as Element[];\n\n  const entries: DomSnapshotEntry[] = targets.slice(0, 100).map((element) => ({\n    selector: computeSelector(element),\n    role: element.getAttribute(\"role\") ?? element.tagName.toLowerCase(),\n    name: makeName(element),\n  }));\n\n  return {\n    snapshot: {\n      title: document.title,\n      url: location.href,\n      capturedAt: new Date().toISOString(),\n      entries,\n    },\n  };\n}\n\nfunction formatSnapshot(snapshot: DomSnapshot): string {\n  const lines: string[] = [];\n  lines.push(`title: ${snapshot.title}`);\n  lines.push(`url: ${snapshot.url}`);\n  lines.push(`capturedAt: ${snapshot.capturedAt}`);\n  lines.push(\"elements:\");\n  for (const entry of snapshot.entries) {\n    lines.push(`  - selector: \"${entry.selector.replace(/\"/g, '\\\\\"')}\"`);\n    lines.push(`    role: ${entry.role}`);\n    lines.push(`    name: \"${entry.name.replace(/\"/g, '\\\\\"')}\"`);\n  }\n  return lines.join(\"\\n\");\n}\n\nfunction delay(ms: number): Promise<void> {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n\ntype ScriptResponse<R> = { ok: true; value?: R } | { error: string };\nasync function runInPage<A extends unknown[], R>(\n  func: (...args: A) => ScriptResponse<R>,\n  args: A,\n): Promise<R | undefined> {\n  const tab = await ensureTab();\n  const [execution] = await chrome.scripting.executeScript({\n    target: { tabId: tab.id! },\n    func,\n    args,\n    world: \"MAIN\",\n  });\n\n  const response = execution?.result as ScriptResponse<R> | undefined;\n  if (!response) {\n    throw new Error(\"Injected script did not return a result\");\n  }\n  if (\"error\" in response) {\n    throw new Error(response.error);\n  }\n  return response.value;\n}\n\nasync function simulateKeyPress(key: string): Promise<void> {\n  await runInPage(\n    (keyValue: string) => {\n      const active = document.activeElement as HTMLElement | null;\n      if (!active) {\n        return { error: \"No element is focused\" };\n      }\n      const init: KeyboardEventInit = { key: keyValue, bubbles: true, cancelable: true };\n      active.dispatchEvent(new KeyboardEvent(\"keydown\", init));\n      active.dispatchEvent(new KeyboardEvent(\"keypress\", init));\n      active.dispatchEvent(new KeyboardEvent(\"keyup\", init));\n      return { ok: true };\n    },\n    [key],\n  );\n}\n\nasync function clickElement(selector: string, description?: string): Promise<void> {\n  await runInPage(\n    (sel: string, label: string | null) => {\n      const element = document.querySelector(sel);\n      if (!element || !(element instanceof HTMLElement)) {\n        return { error: `Element not found: ${label ?? sel}` };\n      }\n      element.focus({ preventScroll: false });\n      element.dispatchEvent(new MouseEvent(\"mousedown\", { bubbles: true, cancelable: true }));\n      element.dispatchEvent(new MouseEvent(\"mouseup\", { bubbles: true, cancelable: true }));\n      element.click();\n      return { ok: true };\n    },\n    [selector, description ?? null],\n  );\n}\n\nasync function hoverElement(selector: string, description?: string): Promise<void> {\n  await runInPage(\n    (sel: string, label: string | null) => {\n      const element = document.querySelector(sel);\n      if (!element || !(element instanceof HTMLElement)) {\n        return { error: `Element not found: ${label ?? sel}` };\n      }\n      element.dispatchEvent(new MouseEvent(\"mouseover\", { bubbles: true, cancelable: true }));\n      element.dispatchEvent(new MouseEvent(\"mousemove\", { bubbles: true, cancelable: true }));\n      element.dispatchEvent(new MouseEvent(\"mouseenter\", { bubbles: true, cancelable: true }));\n      return { ok: true };\n    },\n    [selector, description ?? null],\n  );\n}\n\nasync function typeIntoElement(\n  selector: string,\n  text: string,\n  submit: boolean,\n  description?: string,\n): Promise<void> {\n  await runInPage(\n    (sel: string, value: string, shouldSubmit: boolean, label: string | null) => {\n      const element = document.querySelector(sel);\n      if (!element || !(element instanceof HTMLElement)) {\n        return { error: `Element not found: ${label ?? sel}` };\n      }\n\n      if (element instanceof HTMLInputElement || element instanceof HTMLTextAreaElement) {\n        element.focus({ preventScroll: false });\n        element.value = value;\n        element.dispatchEvent(new Event(\"input\", { bubbles: true, cancelable: true }));\n        element.dispatchEvent(new Event(\"change\", { bubbles: true, cancelable: true }));\n      } else if (element.isContentEditable) {\n        element.focus({ preventScroll: false });\n        element.textContent = value;\n        element.dispatchEvent(new Event(\"input\", { bubbles: true, cancelable: true }));\n      } else {\n        return { error: \"Element is not editable\" };\n      }\n\n      if (shouldSubmit) {\n        const init: KeyboardEventInit = { key: \"Enter\", bubbles: true, cancelable: true };\n        element.dispatchEvent(new KeyboardEvent(\"keydown\", init));\n        element.dispatchEvent(new KeyboardEvent(\"keyup\", init));\n        if (element instanceof HTMLInputElement || element instanceof HTMLTextAreaElement) {\n          element.form?.dispatchEvent(new Event(\"submit\", { bubbles: true, cancelable: true }));\n        }\n      }\n\n      return { ok: true };\n    },\n    [selector, text, submit, description ?? null],\n  );\n}\n\nasync function selectOptions(selector: string, values: string[], description?: string): Promise<void> {\n  await runInPage(\n    (sel: string, valueList: string[], label: string | null) => {\n      const element = document.querySelector(sel);\n      if (!(element instanceof HTMLSelectElement)) {\n        return { error: `Element is not a <select>: ${label ?? sel}` };\n      }\n\n      const targets = new Set(valueList);\n      let matched = 0;\n      for (const option of Array.from(element.options)) {\n        const shouldSelect =\n          targets.has(option.value) || targets.has(option.label) || targets.has(option.textContent ?? \"\");\n        if (shouldSelect) {\n          option.selected = true;\n          matched++;\n          if (!element.multiple) {\n            break;\n          }\n        } else if (!element.multiple) {\n          option.selected = false;\n        }\n      }\n\n      if (matched === 0) {\n        return { error: \"None of the provided values matched\" };\n      }\n\n      element.dispatchEvent(new Event(\"input\", { bubbles: true, cancelable: true }));\n      element.dispatchEvent(new Event(\"change\", { bubbles: true, cancelable: true }));\n\n      return { ok: true };\n    },\n    [selector, values, description ?? null],\n  );\n}\n\nasync function takeScreenshot(fullPage: boolean): Promise<{ data: string; mimeType: string }> {\n  const tab = await ensureTab();\n  let base64: string | undefined;\n\n  try {\n    base64 = await captureScreenshotWithDebugger(tab.id!, fullPage);\n  } catch (error) {\n    console.warn(\"[yetibrowser] debugger capture failed, falling back\", error);\n  }\n\n  if (!base64) {\n    base64 = await captureVisibleTabFallback(tab.windowId!);\n  }\n\n  return await encodeScreenshot(base64);\n}\n\nconst DEBUGGER_PROTOCOL_VERSION = \"1.3\";\n\nasync function captureScreenshotWithDebugger(tabId: number, fullPage: boolean): Promise<string | undefined> {\n  const target: chrome.debugger.Debuggee = { tabId };\n  await attachDebugger(target);\n  let metricsOverridden = false;\n\n  try {\n    await sendDebuggerCommand(target, \"Page.enable\");\n\n    if (fullPage) {\n      try {\n        const metrics = await sendDebuggerCommand<{ contentSize?: { width?: number; height?: number } }>(\n          target,\n          \"Page.getLayoutMetrics\",\n        );\n        const width = Math.ceil(metrics.contentSize?.width ?? 0);\n        const height = Math.ceil(metrics.contentSize?.height ?? 0);\n        if (width > 0 && height > 0) {\n          await sendDebuggerCommand(target, \"Emulation.setDeviceMetricsOverride\", {\n            mobile: false,\n            deviceScaleFactor: 1,\n            width,\n            height,\n            screenWidth: width,\n            screenHeight: height,\n            viewport: {\n              x: 0,\n              y: 0,\n              width,\n              height,\n              scale: 1,\n            },\n          });\n          metricsOverridden = true;\n        }\n      } catch (error) {\n        console.warn(\"[yetibrowser] layout metrics unavailable, skipping full-page override\", error);\n      }\n    }\n\n    const screenshot = await sendDebuggerCommand<{ data: string }>(target, \"Page.captureScreenshot\", {\n      format: \"png\",\n      captureBeyondViewport: fullPage,\n    });\n\n    if (metricsOverridden) {\n      await sendDebuggerCommand(target, \"Emulation.clearDeviceMetricsOverride\");\n    }\n\n    return screenshot.data;\n  } finally {\n    await detachDebugger(target);\n  }\n}\n\nasync function captureVisibleTabFallback(windowId: number): Promise<string> {\n  if (windowId === undefined) {\n    throw new Error(\"Unable to determine window for active tab\");\n  }\n\n  const dataUrl = await new Promise<string>((resolve, reject) => {\n    chrome.tabs.captureVisibleTab(windowId, { format: \"png\" }, (result) => {\n      const error = chrome.runtime.lastError;\n      if (error) {\n        reject(new Error(error.message));\n        return;\n      }\n      if (!result) {\n        reject(new Error(\"Failed to capture screenshot\"));\n        return;\n      }\n      resolve(result);\n    });\n  });\n\n  const [, base64] = dataUrl.split(\",\");\n  if (!base64) {\n    throw new Error(\"Unexpected screenshot data format\");\n  }\n  return base64;\n}\n\nasync function attachDebugger(target: chrome.debugger.Debuggee): Promise<void> {\n  await new Promise<void>((resolve, reject) => {\n    chrome.debugger.attach(target, DEBUGGER_PROTOCOL_VERSION, () => {\n      const error = chrome.runtime.lastError;\n      if (error) {\n        if (error.message?.includes(\"Another debugger is already attached\")) {\n          resolve();\n          return;\n        }\n        reject(new Error(error.message));\n        return;\n      }\n      resolve();\n    });\n  });\n}\n\nasync function detachDebugger(target: chrome.debugger.Debuggee): Promise<void> {\n  await new Promise<void>((resolve) => {\n    chrome.debugger.detach(target, () => {\n      const error = chrome.runtime.lastError;\n      if (error && !error.message?.includes(\"No debugger is connected\")) {\n        console.warn(\"[yetibrowser] failed to detach debugger\", error);\n      }\n      resolve();\n    });\n  });\n}\n\nasync function encodeScreenshot(base64Png: string): Promise<{ data: string; mimeType: string }> {\n  const bytes = Uint8Array.from(atob(base64Png), (char) => char.charCodeAt(0));\n  const blob = new Blob([bytes], { type: \"image/png\" });\n  const bitmap = await createImageBitmap(blob);\n\n  const maxWidth = 1280;\n  const scale = bitmap.width > maxWidth ? maxWidth / bitmap.width : 1;\n  const targetWidth = Math.round(bitmap.width * scale);\n  const targetHeight = Math.round(bitmap.height * scale);\n\n  const canvas = new OffscreenCanvas(targetWidth, targetHeight);\n  const ctx = canvas.getContext(\"2d\");\n  if (!ctx) {\n    throw new Error(\"Unable to create drawing context for screenshot\");\n  }\n  ctx.drawImage(bitmap, 0, 0, targetWidth, targetHeight);\n\n  let outputBlob: Blob;\n  let mimeType = \"image/webp\";\n  try {\n    outputBlob = await canvas.convertToBlob({ type: \"image/webp\", quality: 0.85 });\n  } catch (error) {\n    console.warn(\"[yetibrowser] webp conversion failed, falling back to jpeg\", error);\n    outputBlob = await canvas.convertToBlob({ type: \"image/jpeg\", quality: 0.85 });\n    mimeType = \"image/jpeg\";\n  }\n\n  const arrayBuffer = await outputBlob.arrayBuffer();\n  const outputBytes = new Uint8Array(arrayBuffer);\n  let binary = \"\";\n  outputBytes.forEach((byte) => {\n    binary += String.fromCharCode(byte);\n  });\n  return { data: btoa(binary), mimeType };\n}\n\nasync function sendDebuggerCommand<T>(\n  target: chrome.debugger.Debuggee,\n  method: string,\n  params?: Record<string, unknown>,\n): Promise<T> {\n  return await new Promise<T>((resolve, reject) => {\n    chrome.debugger.sendCommand(target, method, params, (result) => {\n      const error = chrome.runtime.lastError;\n      if (error) {\n        reject(new Error(error.message));\n        return;\n      }\n      resolve((result ?? {}) as T);\n    });\n  });\n}\n\nasync function readConsoleLogs(): Promise<ConsoleLogEntry[]> {\n  const tab = await ensureTab();\n  await ensurePageHelpers(tab.id!);\n  const logs = await runInPage(() => {\n    const win = window as typeof window & { __yetibrowser?: { logs?: ConsoleLogEntry[] } };\n    const entries = Array.isArray(win.__yetibrowser?.logs) ? win.__yetibrowser!.logs! : [];\n    return { ok: true, value: entries.slice(-200) };\n  }, []);\n  return logs ?? [];\n}\n\nasync function initializeTab(tabId: number): Promise<void> {\n  try {\n    await ensurePageHelpers(tabId);\n  } catch (error) {\n    console.warn(\"[yetibrowser] failed to initialize tab helpers\", error);\n  }\n  void updateBadge();\n}\n\nasync function ensurePageHelpers(tabId: number): Promise<void> {\n  await chrome.scripting.executeScript({\n    target: { tabId },\n    world: \"MAIN\",\n    func: () => {\n      const win = window as typeof window & {\n        __yetibrowser?: {\n          initialized?: boolean;\n          logs: ConsoleLogEntry[];\n        };\n      };\n\n      const install = () => {\n        const maxEntries = 500;\n        const state = win.__yetibrowser ?? { logs: [] as ConsoleLogEntry[] };\n        const logs = Array.isArray(state.logs) ? state.logs : [];\n\n        const originals = {\n          log: console.log.bind(console),\n          info: console.info.bind(console),\n          warn: console.warn.bind(console),\n          error: console.error.bind(console),\n        };\n\n        const serialize = (value: unknown) => {\n          if (typeof value === \"string\") {\n            return value;\n          }\n          if (value instanceof Error) {\n            return value.message;\n          }\n          try {\n            const serialized = JSON.stringify(value);\n            return serialized ?? String(value);\n          } catch (error) {\n            return String(value);\n          }\n        };\n\n        const extractStack = (values: unknown[]): string | undefined => {\n          for (const value of values) {\n            if (value instanceof Error && value.stack) {\n              return value.stack;\n            }\n            if (typeof value === \"string\" && value.includes(\"\\n    at \")) {\n              return value;\n            }\n          }\n          return undefined;\n        };\n\n        const pushEntry = (\n          level: keyof typeof originals,\n          args: unknown[],\n          explicitStack?: string,\n        ) => {\n          const message = args\n            .map((arg) => serialize(arg))\n            .filter((part) => part.length > 0)\n            .join(\" \") || level;\n          const stack = explicitStack ?? extractStack(args);\n          logs.push({ level, message, timestamp: Date.now(), stack });\n          if (logs.length > maxEntries) {\n            logs.shift();\n          }\n        };\n\n        const wrap = (level: keyof typeof originals) =>\n          (...args: unknown[]) => {\n            pushEntry(level, args);\n            originals[level](...args);\n          };\n\n        console.log = wrap(\"log\") as typeof console.log;\n        console.info = wrap(\"info\") as typeof console.info;\n        console.warn = wrap(\"warn\") as typeof console.warn;\n        console.error = wrap(\"error\") as typeof console.error;\n\n        window.addEventListener(\"error\", (event) => {\n          const details: unknown[] = [event.message];\n          if (event.filename) {\n            const locationParts = [event.filename];\n            if (typeof event.lineno === \"number\") {\n              locationParts.push(String(event.lineno));\n            }\n            if (typeof event.colno === \"number\") {\n              locationParts.push(String(event.colno));\n            }\n            details.push(locationParts.join(\":\"));\n          }\n          const stack = event.error instanceof Error ? event.error.stack ?? undefined : undefined;\n          pushEntry(\"error\", details, stack);\n          originals.error(event.message, event.error ?? event);\n        });\n\n        window.addEventListener(\"unhandledrejection\", (event) => {\n          const reason = event.reason;\n          let message: string;\n          let stack: string | undefined;\n          if (reason instanceof Error) {\n            message = reason.message;\n            stack = reason.stack ?? undefined;\n          } else {\n            message = serialize(reason);\n          }\n          pushEntry(\"error\", [\"Unhandled promise rejection\", message], stack);\n          originals.error(\"Unhandled promise rejection\", reason);\n        });\n\n        logs.push({ level: \"debug\", message: \"[yetibrowser] console hooks installed\", timestamp: Date.now() });\n\n        win.__yetibrowser = {\n          initialized: true,\n          logs,\n        };\n      };\n\n      if (!win.__yetibrowser?.initialized) {\n        install();\n        return;\n      }\n\n      if (!Array.isArray(win.__yetibrowser.logs)) {\n        install();\n      }\n    },\n  });\n\n  const tab = await chrome.tabs.get(tabId);\n  if (tab.url?.startsWith(\"chrome://\") || tab.url?.startsWith(\"edge://\") || tab.url?.startsWith(\"about:\")) {\n    console.warn(\"[yetibrowser] unable to inject helpers into special page\", tab.url);\n  }\n}\n\nasync function updateBadge(): Promise<void> {\n  const isConnected = connectedTabId !== null && socket?.readyState === WebSocket.OPEN;\n  try {\n    const text = isConnected ? \"●\" : \"\";\n    await chrome.action.setBadgeText({ text });\n    if (isConnected) {\n      try {\n        await chrome.action.setBadgeBackgroundColor({ color: \"#111827\" });\n      } catch (error) {\n        console.warn(\"[yetibrowser] failed to set badge background\", error);\n      }\n      if (chrome.action.setBadgeTextColor) {\n        try {\n          await chrome.action.setBadgeTextColor({ color: \"#facc15\" });\n        } catch (error) {\n          console.warn(\"[yetibrowser] failed to set badge text color\", error);\n        }\n      }\n    }\n  } catch (error) {\n    console.warn(\"[yetibrowser] failed to set badge\", error);\n  }\n}\n"],"mappings":"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","names":[]}