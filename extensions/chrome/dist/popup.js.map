{"version":3,"sources":["../../shared/src/popup/index.ts"],"sourcesContent":["const statusEl = document.getElementById(\"status\") as HTMLDivElement;\nconst connectButton = document.getElementById(\"connect\") as HTMLButtonElement;\nconst disconnectButton = document.getElementById(\"disconnect\") as HTMLButtonElement;\n\nlet lastError: string | null = null;\n\nconnectButton.addEventListener(\"click\", async () => {\n  lastError = null;\n  try {\n    const activeTab = await getActiveTab();\n    if (!activeTab || activeTab.id === undefined) {\n      throw new Error(\"Unable to determine active tab\");\n    }\n\n    if (!isUrlAllowed(activeTab.url ?? \"\")) {\n      throw new Error(\"This page cannot be controlled. Switch to an http(s) tab and try again.\");\n    }\n\n    await chrome.runtime.sendMessage({ type: \"yetibrowser/connect\", tabId: activeTab.id });\n  } catch (error) {\n    lastError = error instanceof Error ? error.message : String(error);\n  } finally {\n    await refresh();\n  }\n});\n\ndisconnectButton.addEventListener(\"click\", async () => {\n  lastError = null;\n  try {\n    await chrome.runtime.sendMessage({ type: \"yetibrowser/disconnect\" });\n  } catch (error) {\n    lastError = error instanceof Error ? error.message : String(error);\n  } finally {\n    await refresh();\n  }\n});\n\nvoid refresh();\n\nasync function refresh() {\n  const state = await chrome.runtime.sendMessage({ type: \"yetibrowser/getState\" });\n  const activeTab = await getActiveTab();\n  updateUi(state, activeTab);\n}\n\nfunction updateUi(\n  state: { tabId: number | null; socketConnected: boolean; wsPort: number },\n  activeTab: chrome.tabs.Tab | undefined,\n) {\n  const { tabId, socketConnected, wsPort } = state;\n\n  const activeTabId = activeTab?.id ?? null;\n  const isConnectedToActive = tabId !== null && tabId === activeTabId;\n\n  connectButton.disabled = !activeTabId || isConnectedToActive || !isUrlAllowed(activeTab?.url ?? \"\");\n  disconnectButton.disabled = tabId === null;\n\n  const parts: string[] = [];\n  if (tabId) {\n    parts.push(`Connected: tab ${tabId}`);\n    if (!isConnectedToActive) {\n      parts.push(\"(switch to the connected tab to interact)\");\n    }\n  } else {\n    parts.push(\"No tab connected\");\n  }\n\n  parts.push(socketConnected ? `Server: ws://localhost:${wsPort}` : \"Server: not connected\");\n\n  if (lastError) {\n    parts.push(`Error: ${lastError}`);\n  }\n\n  statusEl.textContent = parts.join(\"\\n\");\n}\n\nasync function getActiveTab(): Promise<chrome.tabs.Tab | undefined> {\n  const tabs = await chrome.tabs.query({ active: true, currentWindow: true });\n  return tabs[0];\n}\n\nfunction isUrlAllowed(url: string): boolean {\n  if (!url) {\n    return false;\n  }\n  if (url.startsWith(\"chrome://\") || url.startsWith(\"chrome-extension://\")) {\n    return false;\n  }\n  if (url.startsWith(\"edge://\") || url.startsWith(\"about:\")) {\n    return false;\n  }\n  return true;\n}\n"],"mappings":";AAAA,IAAM,WAAW,SAAS,eAAe,QAAQ;AACjD,IAAM,gBAAgB,SAAS,eAAe,SAAS;AACvD,IAAM,mBAAmB,SAAS,eAAe,YAAY;AAE7D,IAAI,YAA2B;AAE/B,cAAc,iBAAiB,SAAS,YAAY;AAClD,cAAY;AACZ,MAAI;AACF,UAAM,YAAY,MAAM,aAAa;AACrC,QAAI,CAAC,aAAa,UAAU,OAAO,QAAW;AAC5C,YAAM,IAAI,MAAM,gCAAgC;AAAA,IAClD;AAEA,QAAI,CAAC,aAAa,UAAU,OAAO,EAAE,GAAG;AACtC,YAAM,IAAI,MAAM,yEAAyE;AAAA,IAC3F;AAEA,UAAM,OAAO,QAAQ,YAAY,EAAE,MAAM,uBAAuB,OAAO,UAAU,GAAG,CAAC;AAAA,EACvF,SAAS,OAAO;AACd,gBAAY,iBAAiB,QAAQ,MAAM,UAAU,OAAO,KAAK;AAAA,EACnE,UAAE;AACA,UAAM,QAAQ;AAAA,EAChB;AACF,CAAC;AAED,iBAAiB,iBAAiB,SAAS,YAAY;AACrD,cAAY;AACZ,MAAI;AACF,UAAM,OAAO,QAAQ,YAAY,EAAE,MAAM,yBAAyB,CAAC;AAAA,EACrE,SAAS,OAAO;AACd,gBAAY,iBAAiB,QAAQ,MAAM,UAAU,OAAO,KAAK;AAAA,EACnE,UAAE;AACA,UAAM,QAAQ;AAAA,EAChB;AACF,CAAC;AAED,KAAK,QAAQ;AAEb,eAAe,UAAU;AACvB,QAAM,QAAQ,MAAM,OAAO,QAAQ,YAAY,EAAE,MAAM,uBAAuB,CAAC;AAC/E,QAAM,YAAY,MAAM,aAAa;AACrC,WAAS,OAAO,SAAS;AAC3B;AAEA,SAAS,SACP,OACA,WACA;AACA,QAAM,EAAE,OAAO,iBAAiB,OAAO,IAAI;AAE3C,QAAM,cAAc,WAAW,MAAM;AACrC,QAAM,sBAAsB,UAAU,QAAQ,UAAU;AAExD,gBAAc,WAAW,CAAC,eAAe,uBAAuB,CAAC,aAAa,WAAW,OAAO,EAAE;AAClG,mBAAiB,WAAW,UAAU;AAEtC,QAAM,QAAkB,CAAC;AACzB,MAAI,OAAO;AACT,UAAM,KAAK,kBAAkB,KAAK,EAAE;AACpC,QAAI,CAAC,qBAAqB;AACxB,YAAM,KAAK,2CAA2C;AAAA,IACxD;AAAA,EACF,OAAO;AACL,UAAM,KAAK,kBAAkB;AAAA,EAC/B;AAEA,QAAM,KAAK,kBAAkB,0BAA0B,MAAM,KAAK,uBAAuB;AAEzF,MAAI,WAAW;AACb,UAAM,KAAK,UAAU,SAAS,EAAE;AAAA,EAClC;AAEA,WAAS,cAAc,MAAM,KAAK,IAAI;AACxC;AAEA,eAAe,eAAqD;AAClE,QAAM,OAAO,MAAM,OAAO,KAAK,MAAM,EAAE,QAAQ,MAAM,eAAe,KAAK,CAAC;AAC1E,SAAO,KAAK,CAAC;AACf;AAEA,SAAS,aAAa,KAAsB;AAC1C,MAAI,CAAC,KAAK;AACR,WAAO;AAAA,EACT;AACA,MAAI,IAAI,WAAW,WAAW,KAAK,IAAI,WAAW,qBAAqB,GAAG;AACxE,WAAO;AAAA,EACT;AACA,MAAI,IAAI,WAAW,SAAS,KAAK,IAAI,WAAW,QAAQ,GAAG;AACzD,WAAO;AAAA,EACT;AACA,SAAO;AACT;","names":[]}